
@{
    ViewBag.Title = "SetRole";
    Layout = "~/Views/Shared/_LayoutAgentV2.cshtml";
}

@model Dictionary<QingFeng.Common.AgentEnums.MenuEnum, List<QingFeng.Common.AgentEnums.SubMenuEnum>>

<div class="modal-content">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="edit-model-label">用户授权</h4>
    </div>
    <form class="form-horizontal" role="form" onsubmit="return submitBefore()" id="setting-form" method="post" action="http://www.tonyzu.com/menu/setRole">
        @foreach (var item in Model)
        {
            <div class="modal-body">
                <div class="panel panel-info">
                    <div class="panel-heading">@item.Key.ToString()</div>
                    <div class="panel-body">
                        @foreach (var menu in item.Value)
                        {
                            <label class="checkbox-inline">
                                <input type="checkbox" id="role-@(menu.GetHashCode())" class="checkbox-@(item.Key.GetHashCode()) role-checkbox" value="@(menu.GetHashCode())">@menu.ToString()
                            </label>
                        }
                    </div>
                </div>
            </div>
        }
        <div class="modal-footer" style="text-align: center;">
            <input name="userRoles" id="userRoles" type="hidden" />
            <input name="userId" id="userId" value="@ViewBag.userId" type="hidden"/>
            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            <button type="submit" class="btn btn-primary">提交</button>
        </div>
    </form>
</div>
<script>
    var userRoles = '@(ViewBag.userRoles)';
    var selector = $.map(userRoles.split(','), function (menuId) {
        return "#role-" + menuId;
    }).toString();
    $(selector).attr("checked", "checked");

    function submitBefore() {
        var array = [];
        $(":checkbox[id^=role-]:checked").each(function() {
            array.push($(this).val());
        });
        $("#userRoles").val(array.toString());
        return true;
    }
</script>

